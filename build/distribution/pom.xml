<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
	<modelVersion>4.0.0</modelVersion>
	<parent>
		<artifactId>ontop-build</artifactId>
		<groupId>it.unibz.inf.ontop</groupId>
		<version>4.1.0-beta-1-SNAPSHOT</version>
		<relativePath>..</relativePath>
	</parent>
	<artifactId>ontop-distribution</artifactId>
	<name>ontop-distribution</name>
	<description>Builds the distribution files for quest and the core apis.</description>

    <properties>
        <assembly.appendAssemblyId>false</assembly.appendAssemblyId>
        <jetty.bundle.version>9.4.20.v20190813</jetty.bundle.version>
        <tomcat.bundle.version>9.0.24</tomcat.bundle.version>
		<protege.desktop.version>5.5.0</protege.desktop.version>
        <protege.bundle.rootdir>Protege-5.5.0</protege.bundle.rootdir>
    </properties>

	<dependencies>
		<dependency>
			<groupId>${project.groupId}</groupId>
			<artifactId>ontop-owlapi</artifactId>
			<version>${project.version}</version>
		</dependency>
		<dependency>
			<groupId>com.h2database</groupId>
			<artifactId>h2</artifactId>
		</dependency>
		<dependency>
			<groupId>${project.groupId}</groupId>
			<artifactId>ontop-rdf4j</artifactId>
			<version>${project.version}</version>
		</dependency>
		<dependency>
			<groupId>${project.groupId}</groupId>
			<artifactId>ontop-cli</artifactId>
			<version>${project.version}</version>
		</dependency>
		<dependency>
			<groupId>${project.groupId}</groupId>
			<artifactId>ontop-rdf4j-server</artifactId>
			<version>${project.version}</version>
			<type>war</type>
		</dependency>
		<dependency>
			<groupId>${project.groupId}</groupId>
			<artifactId>ontop-rdf4j-workbench</artifactId>
			<version>${project.version}</version>
			<type>war</type>
		</dependency>
		<dependency>
			<!-- this dependency serves to order ontop-distribution after ontop-protege
			     during a multi-module build, so that ontop-protege bundle can be
			     resolved from reactor instead of having to install & download it from
			     a maven repository -->
			<groupId>${project.groupId}</groupId>
			<artifactId>ontop-protege</artifactId>
			<version>${project.version}</version>
			<exclusions>
				<exclusion>
					<groupId>*</groupId>
					<artifactId>*</artifactId>
				</exclusion>
			</exclusions>
		</dependency>
	</dependencies>

	<build>
		<plugins>
			 <plugin>
        		<groupId>org.apache.maven.plugins</groupId>
        		<artifactId>maven-jar-plugin</artifactId>
        		<configuration>
          			<excludes>
            			<exclude>jetty/*</exclude>
            			<exclude>openrdf/*</exclude>
          			</excludes>
        		</configuration>
     		</plugin>
			<plugin>
				<groupId>org.apache.maven.plugins</groupId>
				<artifactId>maven-deploy-plugin</artifactId>
				<configuration>
					<skip>true</skip>
				</configuration>
			</plugin>
		</plugins>
	</build>

	<profiles>
		<profile>
			<id>release</id>
			<build>
				<plugins>
					<plugin>
						<groupId>org.apache.maven.plugins</groupId>
						<artifactId>maven-dependency-plugin</artifactId>
						<executions>
							<execution>
								<id>unpack-protege-platform-independent</id>
								<phase>prepare-package</phase>
								<goals>
									<goal>unpack</goal>
								</goals>
								<configuration>
									<outputDirectory>${project.build.directory}/unpack/protege-desktop-platform-independent/</outputDirectory>
									<artifactItems>
										<artifactItem>
											<groupId>edu.stanford.protege</groupId>
											<artifactId>protege-desktop</artifactId>
											<version>${protege.desktop.version}</version>
											<classifier>platform-independent</classifier>
											<type>zip</type>
										</artifactItem>
									</artifactItems>
								</configuration>
							</execution>
							<execution>
								<id>unpack-protege-os-x</id>
								<phase>prepare-package</phase>
								<goals>
									<goal>unpack</goal>
								</goals>
								<configuration>
									<outputDirectory>${project.build.directory}/unpack/protege-desktop-os-x/</outputDirectory>
									<artifactItems>
										<artifactItem>
											<groupId>edu.stanford.protege</groupId>
											<artifactId>protege-desktop</artifactId>
											<version>${protege.desktop.version}</version>
											<classifier>os-x</classifier>
											<type>zip</type>
										</artifactItem>
									</artifactItems>
								</configuration>
							</execution>
							<execution>
								<id>unpack-protege-win</id>
								<phase>prepare-package</phase>
								<goals>
									<goal>unpack</goal>
								</goals>
								<configuration>
									<outputDirectory>${project.build.directory}/unpack/protege-desktop-win/</outputDirectory>
									<artifactItems>
										<artifactItem>
											<groupId>edu.stanford.protege</groupId>
											<artifactId>protege-desktop</artifactId>
											<version>${protege.desktop.version}</version>
											<classifier>win</classifier>
											<type>zip</type>
										</artifactItem>
									</artifactItems>
								</configuration>
							</execution>
							<execution>
								<id>unpack-protege-linux</id>
								<phase>prepare-package</phase>
								<goals>
									<goal>unpack</goal>
								</goals>
								<configuration>
									<outputDirectory>${project.build.directory}/unpack/protege-desktop-linux/</outputDirectory>
									<artifactItems>
										<artifactItem>
											<groupId>edu.stanford.protege</groupId>
											<artifactId>protege-desktop</artifactId>
											<version>${protege.desktop.version}</version>
											<classifier>linux</classifier>
											<type>tar.gz</type>
										</artifactItem>
									</artifactItems>
								</configuration>
							</execution>
							<execution>
								<id>unpack-jetty-tomcat</id>
								<phase>prepare-package</phase>
								<goals>
									<goal>unpack</goal>
								</goals>
								<configuration>
									<outputDirectory>${project.build.directory}/unpack/</outputDirectory>
									<artifactItems>
										<artifactItem>
											<groupId>org.eclipse.jetty</groupId>
											<artifactId>jetty-distribution</artifactId>
											<version>${jetty.bundle.version}</version>
											<type>zip</type>
										</artifactItem>
										<artifactItem>
											<groupId>org.apache.tomcat</groupId>
											<artifactId>tomcat</artifactId>
											<version>${tomcat.bundle.version}</version>
											<type>zip</type>
										</artifactItem>
									</artifactItems>
								</configuration>
							</execution>
							<execution>
								<id>copy-protege-plugin</id>
								<phase>prepare-package</phase>
								<goals>
									<goal>copy</goal>
								</goals>
								<configuration>
									<outputDirectory>${project.build.directory}/</outputDirectory>
									<artifactItems>
										<artifactItem>
											<groupId>it.unibz.inf.ontop</groupId>
											<artifactId>ontop-protege</artifactId>
											<version>${project.version}</version>
											<classifier>bundle</classifier>
											<destFileName>it.unibz.inf.ontop.protege-${project.version}.jar</destFileName>
										</artifactItem>
									</artifactItems>
								</configuration>
							</execution>
						</executions>
					</plugin>
					<plugin>
						<groupId>org.apache.maven.plugins</groupId>
						<artifactId>maven-assembly-plugin</artifactId>
						<executions>
							<execution>
								<id>attach-cli-assembly</id>
								<phase>package</phase>
								<goals>
									<goal>single</goal>
								</goals>
								<configuration>
									<descriptors>
										<descriptor>src/assembly/ontop-cli.xml</descriptor>
									</descriptors>
									<finalName>ontop-cli-${project.version}</finalName>
								</configuration>
							</execution>
							<execution>
								<id>attach-webapps-assembly</id>
								<phase>package</phase>
								<goals>
									<goal>single</goal>
								</goals>
								<configuration>
									<descriptors>
										<descriptor>src/assembly/ontop-webapps.xml</descriptor>
									</descriptors>
									<finalName>ontop-webapps-${project.version}</finalName>
								</configuration>
							</execution>
							<execution>
								<id>attach-tomcat-bundle</id>
								<phase>package</phase>
								<goals>
									<goal>single</goal>
								</goals>
								<configuration>
									<descriptors>
										<descriptor>src/assembly/ontop-tomcat-bundle.xml</descriptor>
									</descriptors>
									<finalName>ontop-tomcat-bundle-${project.version}</finalName>
								</configuration>
							</execution>
							<execution>
								<id>attach-jetty-bundle</id>
								<phase>package</phase>
								<goals>
									<goal>single</goal>
								</goals>
								<configuration>
									<descriptors>
										<descriptor>src/assembly/ontop-jetty-bundle.xml</descriptor>
									</descriptors>
									<finalName>ontop-jetty-bundle-${project.version}</finalName>
								</configuration>
							</execution>
							<execution>
								<id>attach-protege-bundle-platform-independent</id>
								<phase>package</phase>
								<goals>
									<goal>single</goal>
								</goals>
								<configuration>
									<descriptors>
										<descriptor>src/assembly/ontop-protege-bundle-platform-independent.xml</descriptor>
									</descriptors>
									<finalName>ontop-protege-bundle-platform-independent-${project.version}</finalName>
								</configuration>
							</execution>
							<execution>
								<id>attach-protege-bundle-win</id>
								<phase>package</phase>
								<goals>
									<goal>single</goal>
								</goals>
								<configuration>
									<descriptors>
										<descriptor>src/assembly/ontop-protege-bundle-win.xml</descriptor>
									</descriptors>
									<finalName>ontop-protege-bundle-win-${project.version}</finalName>
								</configuration>
							</execution>
							<execution>
								<id>attach-protege-bundle-linux</id>
								<phase>package</phase>
								<goals>
									<goal>single</goal>
								</goals>
								<configuration>
									<descriptors>
										<descriptor>src/assembly/ontop-protege-bundle-linux.xml</descriptor>
									</descriptors>
									<finalName>ontop-protege-bundle-linux-${project.version}</finalName>
								</configuration>
							</execution>
							<execution>
								<id>attach-protege-bundle-os-x</id>
								<phase>package</phase>
								<goals>
									<goal>single</goal>
								</goals>
								<configuration>
									<descriptors>
										<descriptor>src/assembly/ontop-protege-bundle-os-x.xml</descriptor>
									</descriptors>
									<finalName>ontop-protege-bundle-os-x-${project.version}</finalName>
								</configuration>
							</execution>
						</executions>
					</plugin>
				</plugins>
			</build>
		</profile>
	</profiles>

</project>
